<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!--<meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="keywords" content="" />

  <title>Preparing files for CLASlite using R</title>
  <meta name="description" content="CLASlite is a powerful software designed to process satellite imagery from its original (raw) format to . I will describe in this post how to use the R langu...">
  
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"> -->
  
  <link href='http://fonts.googleapis.com/css?family=Arimo:400,700' rel='stylesheet' type='text/css'>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->

		<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=r"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="/js/skel.min.js"></script>
		<script src="/js/skel-panels.min.js"></script>
		<script src="/js/init.js"></script>
		<link rel="stylesheet" href="/css/prettify.css"/>

		<noscript>
			<link rel="stylesheet" href="http://amsantac.co/css/skel-noscript.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style-desktop.css"/>
			<!-- <link rel="stylesheet" href="http://amsantac.co/css/main.css"> -->
			<link rel="canonical" href="http://amsantac.co/blog/r/claslite/stacking/2015/09/11/stacking-R.html">
			<link rel="alternate" type="application/rss+xml" title="R-Spatialist" href="/feed.xml" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		
		<link href='http://amsantac.co/feed.xml' rel='alternate' type='application/atom+xml'>
		
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66136840-1', 'auto');
  ga('send', 'pageview');

  </script>
 <link rel="shortcut icon" href="/favicon.ico">
</head>


  <body>

    		<!-- Header -->
		<div id="header">
			<div class="container"> 
				
				<!-- Logo -->
				<div id="logo">
					<h1><a href="/">R-Spatialist</a></h1>
					<span>Smart solutions for geospatial data processing</span>
				</div>
				
				<!-- Nav -->
				<nav id="nav">
					<ul>
						<li><a href="/">Home</a></li>
						<li><a href="/about.html">About</a></li>
						<li><a href="/software.html">Software</a></li>
						<li><a href="/publications.html">Publications</a></li>
						<li><a href="/training.html">Training</a></li>
						<li class="active"><a href="/blog.html">Blog</a></li>
						<li><a href="/contact.html">Contact</a></li>
					</ul>
				</nav>
			</div>
		</div>

    
    		<!-- Main -->
		<div id="main">
			<div class="container">
				<div class="row"> 

													<div id="content" class="8u skel-cell-important">
						<section>
							<header>
								<h2>Preparing files for CLASlite using R</h2>
								
							</header>
							  <article class="post-content">
							        <p><em>Sep 11, 2015</em></p>


  <!-- <article> -->
    <p><a href="http://claslite.carnegiescience.edu/">CLASlite</a> is a powerful software designed to process satellite imagery from its original (raw) format to . I will describe in this post how to use the <a href="http://r-project.org">R language</a> for creating the text files required by CLASlite for stacking imagery through batch processing.</p>

<p>satellite imagery from its original (raw) format, through calibration, pre-processing, atmospheric correction, and cloud masking steps, Monte Carlo Spectral Mixture Analysis, and expert classification to derive high-resolution output images. Usually the first step when processing imagery that has been obtained in raw format is to stack the individual layers into a single file. CLASlite allows stacking Landsat imagery using the 'Prepare Landsat' tool that can be access from the menu Tools - Prepare Landsat in the CLASlite graphical user interface.</p>

<p><img src="/images/2015-09-11-stacking-R-fig-1.png" alt="Stacking Landsat imagery in CLASlite" style="width:600px"></p>

<p>One the nicest features in CLASlite is the possibility of performing processing or preprocessing tasks for several files at a time through batch processing. This avoids repetitive</p>

<p>The 'Prepare Landsat' tool requires the user to enter a CSV file that lists the absolute path of the folder of each Landsat image to be processed. Each folder must contain all the individual</p>

<pre><code>stackImgTable4csv &lt;- function(path, years){
  oldwd &lt;- getwd()
  foldersList &lt;- NULL
    for (year in years){
    path_y &lt;- paste0(path, "/", year)
    setwd(path_y)
    foldersList &lt;- c(foldersList, paste0(path_y, "/", list.files()))
  }
  setwd(oldwd)
  foldersListDF &lt;- data.frame("LANDSAT_Folder_Names" = foldersList)
  return(foldersListDF)
}

## set working directory: folder where the output csv files should be written
setwd("C:/amsantac/PhD/Research/dissertation/processing/landsat/CLASliteCSVs")

## parameters to run the function
path &lt;- "C:/amsantac/PhD/Research/dissertation/data/landsat/images"
years &lt;- 2000:2014
fname &lt;- "stack_2000_2014.csv"

## run the function for the given years
outDF &lt;- stackImgTable4csv(path, years)

## create the csv file
write.csv(outDF, fname, row.names = FALSE, quote = FALSE)
</code></pre>

<p><br></p>

<p>Go to the folder for the corresponding year to process (C:\amsantac\PhD\Research\dissertation\data\landsat\images).
Unzip all the zipped GZ files using "Extract Here". Delete the GZ files.
Unzip all the .tar files using: "Extract to *\". Delete the .tar files.
If needed, repeat steps 1-3 for all the required years
Create the .csv file required by CLASlite using the stackLandsatCSV.R script for the years needed, e.g.:</p>

<p>source the R script</p>

<pre><code>source("https://github.com/amsantac/cuproject/raw/gh-pages/code/stackImgTable4csv.R")
</code></pre>

<p><br>
parameters to run the function</p>

<pre><code>path &lt;- "C:/amsantac/PhD/Research/dissertation/data/landsat/images"
years &lt;- 2000:2014
output &lt;- "stack_2000_2014.csv"

# create the csv file for the given years
stackLandsatCSV(path, years, output)
</code></pre>

<p><br>
Open CLASlite and click "Tools" - "Prepare Landsat". Select "Batch Process" and click the "Load File" button to browse and select the output .csv file created in step 5. Finally click the "Stack" button.</p>

<p>Now you have a fancy web map with legend, layers controls and popups:</p>

<p>In the next post I will provide</p>

  <!-- </article> -->

  <br>
  <p class="rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a></p>
  <br>

<!--  <h2>Comments Section</h2> -->

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'r-spatialist';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script>
$( "pre" ).addClass( "prettyprint lang-r" );
</script>

<!-- <div> -->
<!-- </div> -->

<!-- permalink: /blog/:title -->
							  </article>
						</section>
					</div>

					<!-- <span class="byline">Subtitle</span> -->

				
					<div id="sidebar" class="4u">
						<section>
							<header>
								<h2>Pellentesque vulputate</h2>
							</header>
							<ul class="style">
								<li>
									<p class="posted">August 11, 2002  |  (10 )  Comments</p>
									<img src="images/pic04.jpg" alt="" />
									<p class="text">Nullam non wisi a sem eleifend. Donec mattis libero eget urna. Pellentesque viverra enim.</p>
								</li>
								<li>
									<p class="posted">August 11, 2002  |  (10 )  Comments</p>
									<img src="images/pic05.jpg" alt="" />
									<p class="text">Nullam non wisi a sem eleifend. Donec mattis libero eget urna. Pellentesque viverra enim.</p>
								</li>
								<li>
									<p class="posted">August 11, 2002  |  (10 )  Comments</p>
									<img src="images/pic06.jpg" alt="" />
									<p class="text">Nullam non wisi a sem eleifend. Donec mattis libero eget urna. Pellentesque viverra enim.</p>
								</li>
								<li>
									<p class="posted">August 11, 2002  |  (10 )  Comments</p>
									<img src="images/pic05.jpg" alt="" />
									<p class="text">Nullam non wisi a sem eleifend. Donec mattis libero eget urna. Pellentesque viverra enim.</p>
								</li>
							</ul>
						</section>
					</div>
					<!-- Sidebar -->




				</div>
			</div>
		</div>

    		<!-- Footer -->
		<div id="featured">
			<div class="container">
				<div class="row">
					<div class="4u">
						<h2>Aenean elementum facilisis</h2>
						<a href="#" class="image full"><img src="images/pic01.jpg" alt="" /></a>
						<p>Nullam non wisi a sem semper eleifend. Donec mattis libero eget urna. Donec leo, vivamus fermentum nibh in augue praesent a lacus at urna congue rutrum. Quisque dictum. Pellentesque viverra vulputate enim.</p>
						<p><a href="#" class="button">More Details</a></p>
					</div>
					<div class="4u">
						<h2>Fusce ultrices fringilla</h2>
						<a href="#" class="image full"><img src="images/pic02.jpg" alt="" /></a>
						<p>Nullam non wisi a sem semper eleifend. Donec mattis libero eget urna. Donec leo, vivamus fermentum nibh in augue praesent a lacus at urna congue rutrum. Quisque dictum. Pellentesque viverra vulputate enim.</p>
						<p><a href="#" class="button">More Details</a></p>
					</div>
					<div class="4u">
						<h2>Etiam rhoncus volutpat erat</h2>
						<a href="#" class="image full"><img src="images/pic03.jpg" alt="" /></a>
						<p>Nullam non wisi a sem semper eleifend. Donec mattis libero eget urna. Donec leo, vivamus fermentum nibh in augue praesent a lacus at urna congue rutrum. Quisque dictum. Pellentesque viverra vulputate enim.</p>
						<p><a href="#" class="button">More Details</a></p>
					</div>
				</div>
			</div>
		</div>


		<!-- Footer -->
		<div id="footer">
			<div class="container">
				<div class="row">
					<div class="4u">
						<section>
							<h2>Latest Posts</h2>
							<ul class="default">
								<li><a href="#">Pellentesque lectus gravida blandit</a></li>
								<li><a href="#">Lorem ipsum consectetuer adipiscing</a></li>
								<li><a href="#">Phasellus nibh pellentesque congue</a></li>
								<li><a href="#">Cras vitae metus aliquam pharetra</a></li>
								<li><a href="#">Maecenas vitae orci feugiat eleifend</a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Ultrices fringilla</h2>
							<ul class="default">
								<li><a href="#">Pellentesque lectus gravida blandit</a></li>
								<li><a href="#">Lorem ipsum consectetuer adipiscing</a></li>
								<li><a href="#">Phasellus nibh pellentesque congue</a></li>
								<li><a href="#">Cras vitae metus aliquam pharetra</a></li>
								<li><a href="#">Maecenas vitae orci feugiat eleifend</a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Aenean elementum</h2>
							<ul class="default">
								<li><a href="#">Pellentesque lectus gravida blandit</a></li>
								<li><a href="#">Lorem ipsum consectetuer adipiscing</a></li>
								<li><a href="#">Phasellus nibh pellentesque congue</a></li>
								<li><a href="#">Cras vitae metus aliquam pharetra</a></li>
								<li><a href="#">Maecenas vitae orci feugiat eleifend</a></li>
							</ul>
						</section>
					</div>
				</div>
			</div>
		</div>

    
		<!-- Copyright -->
		<div id="copyright">
			<div class="container">
			  <!--
				Design: <a href="http://templated.co">TEMPLATED</a> Images: <a href="http://unsplash.com">Unsplash</a> (<a href="http://unsplash.com/cc0">CC0</a>)
				-->
			</div>
		</div>
		
		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66136840-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>

</html>

<!--
	Iridium by TEMPLATED
    templated.co @templatedco
    Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
					<!-- Content 
					<div id="content" class="8u skel-cell-important">
					  
					  </div>
					
					Sidebar 
					<div>
					
					</div> -->
		
