<!DOCTYPE html>
<html>

  <head profile="http://www.w3.org/2005/10/profile">
  <meta charset="utf-8">
  <!--<meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="" />
  <meta name="keywords" content="" />

  <title>Using R for file stacking in CLASlite</title>
  <meta name="description" content="CLASlite is a powerful image processing software developed by the Carnegie Institution for Science that provides functionality for calibration, pre-processin...">
  
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"> -->
  
  <link href='http://fonts.googleapis.com/css?family=Arimo:400,700' rel='stylesheet' type='text/css'>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->

		<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=r"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="/js/skel.min.js"></script>
		<script src="/js/skel-panels.min.js"></script>
		<script src="/js/init.js"></script>
		<link rel="stylesheet" href="/css/prettify.css"/>

		<noscript>
			<link rel="stylesheet" href="http://amsantac.co/css/skel-noscript.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style-desktop.css"/>
			<!-- <link rel="stylesheet" href="http://amsantac.co/css/main.css"> -->
			<link rel="canonical" href="http://amsantac.co/blog/en/r/2015/09/05/stacking-R.html">
			<link rel="alternate" type="application/rss+xml" title="R-Spatialist" href="/feed.xml" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		
		<link href='http://amsantac.co/feed.en.xml' rel='alternate' type='application/atom+xml'>
		<link rel="canonical" href="http://amsantac.co/blog/en/r/2015/09/05/stacking-R.html">
		
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66136840-1', 'auto');
  ga('send', 'pageview');

  </script>
 <link rel="shortcut icon" href="/favicon.ico">
</head>


  <body>

    		<!-- Header -->
		<div id="header">
			<div class="container"> 
				
				<!-- Logo -->
				<div id="logo">
					<h1><a href="/">R-Spatialist</a></h1>
					<span>Smart solutions for geospatial data processing</span>
				</div>
				
				<!-- Nav -->
				<nav id="nav">
					<ul>
						<li><a href="/">Home</a></li>
						<li><a href="/about.html">About</a></li>
						<li><a href="/software.html">Software</a></li>
						<li><a href="/publications.html">Publications</a></li>
						<li><a href="/training.html">Training</a></li>
						<li class="active"><a href="/blog.html">Blog</a></li>
						<li><a href="/contact.html">Contact</a></li>
					</ul>
				</nav>
			</div>
		</div>

    
    		<!-- Main -->
		<div id="main">
			<div class="container">
				<div class="row"> 

													<div id="content" class="8u skel-cell-important">
						<section>
							<header>
								<h1>Using R for file stacking in CLASlite</h1>
								
							</header>
							  <article class="post-content">
							        <p><em>Sep 5, 2015</em></p>


  <!-- <article> -->
    <p><a href="http://claslite.carnegiescience.edu/">CLASlite</a> is a powerful image processing software developed by the <a href="https://carnegiescience.edu/">Carnegie Institution for Science</a> that provides functionality for calibration, pre-processing, atmospheric correction, cloud masking, Monte Carlo Spectral Mixture Analysis and classification.</p>

<p>I describe in this post how to use the <a href="http://r-project.org">R language</a> for creating the text files required by CLASlite for stacking imagery through batch processing. This is a simple application that shows R beginners how to make use of basic R functions such as file listing and for loops.</p>

<!--more-->


<p>Usually the first step for processing imagery obtained in raw format is to stack the individual layers into a single file. CLASlite allows stacking Landsat imagery using the 'Prepare Landsat' tool which can be accessed from the Tools - Prepare Landsat menu in the CLASlite graphical user interface:</p>

<p><img src="/images/2015-09-05-stacking-R-fig-1.png" alt="Prepare Landsat Tool in CLASlite" title="Prepare Landsat Tool in CLASlite" style="width:600px"></p>

<p>One pretty useful feature of CLASlite is that a number of processing and preprocessing tasks can be executed for several files at a time through batch processing. For example, the batched 'Prepare Landsat' tool requires the user to enter a CSV file that lists the absolute path of the folder of each Landsat image to be processed. Each folder must contain all the (unzipped) individual files (bands), which are usually obtained from a provider such as the <a href="http://www.usgs.gov">USGS</a>.</p>

<p>CLASlite requires that the CSV file contains the character string: "LANDSAT_Folder_Names" in the first row, and the absolute path of the folder of each image in the following rows as can be seen below:</p>

<p><img src="/images/2015-09-05-stacking-R-fig-2.png" alt="Prepare Landsat template" title="Prepare Landsat template" style="width:400px"></p>

<p>This template can be found in the 'templates' folder inside the directory where CLASlite is installed. We can create a small R script that help us to automate the creation of this CSV file avoiding therefore to waste time on a repetitive action such as manually copying/pasting to a text file. Let's assume that we have a set of images of a given region that have been stored separately by year, as it would be the case for a land cover change study:</p>

<p><img src="/images/2015-09-05-stacking-R-fig-3.png" alt="Folder structure" title="Folder structure" style="width:800px"></p>

<p>The purpose of our R script will be to list all the folders inside each year folders which are contained in the 'images' folder. Let's assume that we have stored images from 2000 to 2015 in our example, so let's create an integer object in R that lists the sequence of years. Let's also create a null object where we will iteratively add the list of folders for each year, and a character object to store the path to our top-level folder 'images':</p>

<pre><code>years &lt;- 2000:2014
foldersList &lt;- NULL
path &lt;- "C:/images"
</code></pre>

<p><br>
Now we can use a <code>for</code> loop to, first, create the absolute path to the folder of each year (<code>path_year</code>), list the folders inside the <code>path_year</code> folder using the <code>list.dirs</code> function, and then add this list of folders to the <code>foldersList</code> object. This will be done iteratively for each year in the <code>years</code> sequence. Sounds complicated uh? Well, the actual code is quite simple:</p>

<pre><code>for (year in years){
  path_year &lt;- paste0(path, "/", year)
  foldersList &lt;- c(foldersList, list.dirs(path_year, recursive = FALSE))
}
</code></pre>

<p><br>
Finally we can create a data frame to store the folders list giving the required name to the data column (i.e., "LANDSAT_Folder_Names"):</p>

<pre><code>foldersListDF &lt;- data.frame("LANDSAT_Folder_Names" = foldersList)
</code></pre>

<p><br>
Usually it is advisable to write a script as a function to facilitate its use in the future. This requires the definition of the required parameters that the function needs to be run. Only two parameters are required in this case, the path to the top-level folder and the sequence of years. Thus, our function, which I have named here as <code>stackImgTable4csv</code>, can be defined as:</p>

<pre><code>stackImgTable4csv &lt;- function(path, years){
  foldersList &lt;- NULL
    for (year in years){
      path_year &lt;- paste0(path, "/", year)
      foldersList &lt;- c(foldersList, list.dirs(path_year, recursive = FALSE))
    }
  foldersListDF &lt;- data.frame("LANDSAT_Folder_Names" = foldersList)
  return(foldersListDF)
}
</code></pre>

<p><br>
With a function defined this way, we just need to call the function and provide the arguments for each of the parameters and the name for the output object (e.g., <code>outDF</code>):</p>

<pre><code>path &lt;- "C:/images"
years &lt;- 2000:2014
outDF &lt;- stackImgTable4csv(path, years)
</code></pre>

<p><br>
Then we can write the ouput data frame to a CSV file that will be loaded into CLASlite. For the <code>write.csv</code> function, we must enter the data to be written and the name of the ouput file (e.g., "stack_2000_2014.csv"). We also have to indicate that the row names must not be written and that the character strings must not be surrounded by double quotes in the ouput file. This is quite important for the CSV file to be read correctly by CLASlite:</p>

<pre><code>write.csv(outDF, file = "stack_2000_2014.csv", row.names = FALSE, quote = FALSE)
</code></pre>

<p><br>
Now we can go back to CLASlite and use the CSV file that we just created. Open CLASlite and click "Tools" - "Prepare Landsat". Select "Batch Process" and click the "Load File" button to browse and select the output CSV file created previously. Finally click the "Stack" button. As a result of the stacking process, you should find raw and thermal files in each image folder:</p>

<p><img src="/images/2015-09-05-stacking-R-fig-4.png" alt="Output folder" title="Ouput folder" style="width:800px"></p>

<p>Hope you found this post helpful! In the next post I will explain how we can use R to automatically create the text files required by CLASlite for producing atmospherically-corrected imagery. See you then!</p>

<p><br>
<br></p>

<p><a id="comments"></a></p>

  <!-- </article> -->

  <br>
  <p><strong>Share this post: &nbsp;&nbsp;</strong></p>
  
  <!-- facebook button -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- g+ button -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  
  <!-- twitter button -->
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  
  
  <div class="social-share">
    <!--<g:plusone></g:plusone>--> 
    <div class="g-plusone" data-size="medium"></div><div class="fb-share-button" data-href="http://amsantac.co/blog/en/r/2015/09/05/stacking-R.html" data-layout="button_count"></div> <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://amsantac.co/blog/en/r/2015/09/05/stacking-R.html">Tweet</a>

    </div>
  <br>
  
  <br>
  
      <p class="rss-subscribe"><strong>Subscribe to my blog <a href="/feed.en.xml">via RSS</a></strong> &nbsp;<a href="/feed.en.xml"><img src="/images/rss.jpg" alt="" style="right;width:15px;height:15px;"/></a></p>
  
  <br>

<!--  <h2>Comments Section</h2> -->

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'r-spatialist';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script>
$( "pre" ).addClass( "prettyprint lang-r" );
</script>

<!-- <div> -->
<!-- </div> -->

<!-- permalink: /blog/:title -->
							  </article>
						</section>
					</div>

					<!-- <span class="byline">Subtitle</span> -->

				
					<div id="sidebar" class="4u">
					  <hr>
					  
					  
					  <a href="https://plus.google.com/u/0/117898713832632782598/"><img src="/images/g+32.png" title="Google+" style="height:32px"></a>  <a href="https://www.linkedin.com/in/amsantac"><img src="/images/linkedin.png" title="LinkedIn" style="height:32px"></a> <a href="http://www.researchgate.net/profile/Ali_Santacruz"><img src="/images/rg-icon-180x180.png" title="ResearchGate" style="height:32px"></a> <a href="https://www.facebook.com/amsantac"><img src="/images/F_icon.png" title="Facebook" style="height:32px"></a>  <a href="/feed.xml"><img src="/images/rss.jpg" title="RSS" style="height:32px"></a>


					  <hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Highlighted blog posts</h2>
							</header>
							<ul class="style">
							  

								
								<li>
									<a href="/blog/en/r/2015/09/05/stacking-R.html"><img src="/images/2015-09-05-stacking-R-icon.png" alt="" width=70 height=70/></a>
									<p class="text"><h4><a href="/blog/en/r/2015/09/05/stacking-R.html">Using R for file stacking in CLASlite</a></h4></p>
									<p class="posted">SEPTEMBER 5, 2015  |  <a href="/blog/en/r/2015/09/05/stacking-R.html#comments">COMMENTS</a></p>
								</li>
								
							</ul>
						</section>
						
						<hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Browse posts by tag</h2>
							</header>

									<p class="text">
									<h4>
									<a href="/tags/R"> R</a>
									&nbsp; | &nbsp; 
									<a href="/tags/GIS"> GIS</a>
									&nbsp; | &nbsp;
									<a href="/tags/RemoteSensing"> Remote Sensing</a>
									&nbsp; | &nbsp;
									<a href="/tags/landsat"> LANDSAT</a>
									&nbsp; | &nbsp; 
									<a href="/tags/CLASlite"> CLASlite </a>
									</h4>
									</p>
									
						</section>
						
					  <hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Recommended sites</h2>
							</header>
							<ul class="style">
								<li>
									<a href="https://plus.google.com/u/0/communities/108037738151282716907"><img src="/images/geomatica.jpg" width=70 height=70></a>
									<p class="text"><h4><a href="https://plus.google.com/u/0/communities/108037738151282716907">GEOMATICA</a></h4></p>
									<p class="posted">G+ COMMUNITY ABOUT GIS & RS</p>
								</li>

								<li>
									<a href="https://plus.google.com/u/0/collection/oefHm"><img src="/images/r-collection-icon.png" width=70 height=70/></a>
									<p class="text"><h4><a href="https://plus.google.com/u/0/collection/oefHm">The R Collection</a></h4></p>
									<p class="posted">SELECTED NEWS AND TIPS ABOUT R</a></p>
								</li>
								
								<li>
									<a href="http://www.r-bloggers.com"><img src="/images/rbloggers.png" width=70 height=70/></a>
									<p class="text"><h4><a href="http://www.r-bloggers.com/">R-BLOGGERS</a></h4></p>
									<p class="posted">R NEWS AND TUTORIALS</a></p>
								</li>

								<li>
									<a href="https://www.facebook.com/DronITech"><img src="/images/CaptureDronEs.png" width=70 height=70/></a>
									<p class="text"><h4><a href="https://www.facebook.com/DronITech">DronIT</a></h4></p>
									<p class="posted">NEWS ABOUT DRONES TECHNOLOGY</a></p>
								</li>

							</ul>
						</section>						
						
					</div>
					<!-- Sidebar -->




				</div>
			</div>
		</div>

    		<!-- Footer -->
		<div id="featured">
			<div class="container">
				<div class="row">
					<div class="4u">
						<h2>The geospt package</h2>
						<a href="/software.html" class="image full"><img src="/images/geospt-featured.png" alt="" /></a>
						<p>This R package provides a set of geostatistical techniques for variogram estimation and cross-validation as well as methods for the design of optimal spatial sampling networks.</p>
						<p><a href="/software.html" class="button">More Details</a></p>
					</div>
					<div class="4u">
						<h2>The diffeR package</h2>
						<a href="/software.html" class="image full"><img src="/images/differ-featured.png" alt="" /></a>
						<p>The diffeR package implements a set of metrics of difference for comparing pairs of maps representing real or categorical variables at original and multiple resolutions.</p>
						<p><a href="/software.html" class="button">More Details</a></p>
					</div>
					<div class="4u">
						<h2>The TOC package</h2>
						<a href="/software.html" class="image full"><img src="/images/toc-featured.png" alt="" /></a>
						<p>This R package allows the construction of the Receiver (aka Relative) Operating Characteristic (ROC) curve and the Total Operating Characteristic (TOC) curve for spatial and non-spatial data.</p>
						<p><a href="/software.html" class="button">More Details</a></p>
					</div>
				</div>
			</div>
		</div>


		<!-- Footer -->
		<div id="footer">
			<div class="container">
				<div class="row">
					<div class="4u">
						<section>
							<h2>Latest Posts</h2>
							<ul class="default">
								
								<li><a href="/blog/en/r/2015/09/05/stacking-R.html">Using R for file stacking in CLASlite</a></li>
								<li><a href="/blog/en/r/2015/08/11/leaflet-R.html">Web mapping with Leaflet and R</a></li>
								<li><a href="/blog/en/2015/08/09/first-post.html">Welcome to the R-Spatialist Blog!</a></li>
								<li><a href="#"></a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Latest publications</h2>
							<ul class="default">
								<li><a href="/publications.html">Quantity and allocation metrics for comparing maps</a></li>
								<li><a href="/publications.html">Evolutionary optimization of spatial sampling networks</a></li>
								<li><a href="/publications.html">Land use change and the landscape matrix  dynamics</a></li>
								<li><a href="/publications.html">Maximizing CDM forestry projects profitability</a></li>
								<li><a href="/publications.html">Classification of rice crops using Radarsat-2</a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Software packages</h2>
							<ul class="default">
								<li><a href="/software.html">The Llanos GEE web app</a></li>
								<li><a href="/software.html">TOC R Shiny web app</a></li>
								<li><a href="/software.html">The TOC R package</a></li>
								<li><a href="/software.html">The diffeR R package</a></li>
								<li><a href="/software.html">The geospt R package</a></li>
							</ul>
						</section>
					</div>
				</div>
			</div>
		</div>
		
	  <!-- Copyright -->
		<div id="copyright">
			<div class="container">
			  <!--
				Design: <a href="http://templated.co">TEMPLATED</a> Images: <a href="http://unsplash.com">Unsplash</a> (<a href="http://unsplash.com/cc0">CC0</a>)
				-->
				&copy; Ali Santacruz - <a href="/blog.html">Version en espanol</a>
			</div>
		</div>

    
  </body>

</html>

<!--
	Iridium by TEMPLATED
    templated.co @templatedco
    Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
					<!-- Content 
					<div id="content" class="8u skel-cell-important">
					  
					  </div>
					
					Sidebar 
					<div>
					
					</div> -->
		
