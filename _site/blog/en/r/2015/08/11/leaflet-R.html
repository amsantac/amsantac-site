<!DOCTYPE html>
<html>

  <head profile="http://www.w3.org/2005/10/profile">
  <meta charset="utf-8">
  <!--<meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="" />
  <meta name="keywords" content="" />

  <title>Web mapping with Leaflet and R</title>
  <meta name="description" content="Leaflet is a JavaScript library that has become quite popular for creating interactive maps. One way to create a map using the Leaflet JS library is to inclu...">
  
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"> -->
  
  <link href='http://fonts.googleapis.com/css?family=Arimo:400,700' rel='stylesheet' type='text/css'>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->

		<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=r"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="/js/skel.min.js"></script>
		<script src="/js/skel-panels.min.js"></script>
		<script src="/js/init.js"></script>
		<link rel="stylesheet" href="/css/prettify.css"/>

		<noscript>
			<link rel="stylesheet" href="http://amsantac.co/css/skel-noscript.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style-desktop.css"/>
			<!-- <link rel="stylesheet" href="http://amsantac.co/css/main.css"> -->
			<link rel="canonical" href="http://amsantac.co/blog/en/r/2015/08/11/leaflet-R.html">
			<link rel="alternate" type="application/rss+xml" title="R-Spatialist" href="/feed.xml" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		
		<link href='http://amsantac.co/feed.en.xml' rel='alternate' type='application/atom+xml'>
		<link rel="canonical" href="http://amsantac.co/blog/en/r/2015/08/11/leaflet-R.html">
		
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66136840-1', 'auto');
  ga('send', 'pageview');

  </script>
 <link rel="shortcut icon" href="/favicon.ico">
</head>


  <body>

    		<!-- Header -->
		<div id="header">
			<div class="container"> 
				
				<!-- Logo -->
				<div id="logo">
					<h1><a href="/">R-Spatialist</a></h1>
					<span>Smart solutions for geospatial data processing</span>
				</div>
				
				<!-- Nav -->
				<nav id="nav">
					<ul>
						<li><a href="/">Home</a></li>
						<li><a href="/about.html">About</a></li>
						<li><a href="/software.html">Software</a></li>
						<li><a href="/publications.html">Publications</a></li>
						<li><a href="/training.html">Training</a></li>
						<li class="active"><a href="/blog.html">Blog</a></li>
						<li><a href="/contact.html">Contact</a></li>
					</ul>
				</nav>
			</div>
		</div>

    
    		<!-- Main -->
		<div id="main">
			<div class="container">
				<div class="row"> 

													<div id="content" class="8u skel-cell-important">
						<section>
							<header>
								<h1>Web mapping with Leaflet and R</h1>
								
							</header>
							  <article class="post-content">
							        <p><em>Aug 11, 2015</em></p>


  <!-- <article> -->
    <p><a href="http://leafletjs.com/">Leaflet</a> is a JavaScript library that has become quite popular for creating interactive maps. One way to create a map using the Leaflet JS library is to include the Leaflet JS and CSS files in the head of a web page and then set up the map in the body of the html page, as shown in the <a href="http://leafletjs.com/examples/quick-start.html">Leaflet Quick Start Guide</a>.</p>

<p>An alternative way is to create the web map in the R environment using an R package called <a href="http://leafletjs.com/">leaflet</a>, developed by the guys from <a href="https://www.rstudio.com/">RStudio</a>, which allows controlling and integrating Leaflet maps in R. In this post I show how to read a vector map in <a href="https://doc.arcgis.com/en/arcgis-online/reference/shapefiles.htm">shapefile</a> format and create a leaflet web map customizing how the vector map is displayed. I will also show how to add a legend, a layers control and popups for displaying attribute data. <!--more-->I recommend to use the <a href="https://www.rstudio.com/products/rstudio/">RStudio IDE</a> for the purpose of this tutorial.</p>

<p>First we need to install the leaflet package in R entering the following command line in the R console:</p>

<pre><code>install.packages("leaflet")
</code></pre>

<p><br>
The next step is to read in R the maps we want to display in our web map. For reading a shapefile, there are a number of functions included in different R packages (see <a href="https://cran.r-project.org/package=rgdal">rgdal</a>, <a href="https://cran.r-project.org/package=maptools">maptools</a>, <a href="https://cran.r-project.org/package=shapefiles">shapefiles</a>, and <a href="http://gis.stackexchange.com/questions/118077/read-esri-shape-file-polygon-or-polyline-in-r-environment">others</a>). I'm going to use the <a href="https://cran.r-project.org/package=raster">raster</a> package, so we need to install it first:</p>

<pre><code>install.packages("raster")
</code></pre>

<p><br>
Now let's load the two packages:</p>

<pre><code>library(raster)
 library(leaflet)
</code></pre>

<p><br>
For this example I am going to import in R a polygon shapefile enclosing the study area of one of my projects. The projection of this map is defined in geographic coordinates (latitude/longitude). Let's use the <code>shapefile</code> function from the raster package to read the file:</p>

<pre><code>llanos &lt;- shapefile("C:/my_dir/llanos.shp")
</code></pre>

<p><br>
In this case the file has been read in R as an <a href="http://www.inside-r.org/packages/cran/sp/docs/as.data.frame.SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a> object called <code>llanos</code>. Now we are going to create the leaflet map using this object for the <code>data</code> argument in the <code>leaflet</code> function. We can do that in just one line of code concatenating several commands with the forward pipe operator <code>%&gt;%</code>. First we create a Leaflet map widget (with the <code>leaflet</code> command) and then add a tile layer (with <code>addTiles</code>), the vector map as polygon (<code>addPolygons</code>) and a legend (<code>addLegend</code>).</p>

<pre><code>leaflet(data = llanos) %&gt;% addTiles() %&gt;% addPolygons(fill = FALSE, stroke = TRUE, color = "#03F") %&gt;% 
  addLegend("bottomright", colors = "#03F", labels = "Llanos ecoregion")
</code></pre>

<p><br>
The <code>fill</code>, <code>stroke</code> and <code>color</code> arguments allow customizing whether to fill the polygon with color, whether to draw the border of the polygon, and the border color, respectively. For the <code>addLegend</code> command, we define the position, colors and labels of the legend. If you are working in RStudio, you should see your map displayed in the 'Viewer' tab when you hit enter:</p>

<p><a href="/images/2015-08-11-leaflet-R-fig-1.png"><img src="/images/2015-08-11-leaflet-R-fig-1.png" alt="Web map with leaflet" style="width:785px"></a></p>

<p>Leaflet displays <a href="http://www.openstreetmap.org/">OpenStreetMap (OSM)</a> tiles by default but you can use any map provider (e.g., <a href="http://www.mapquest.com/">MapQuest Open</a>, <a href="https://www.mapbox.com/">MapBox</a>, <a href="http://www.microsoft.com/maps/choose-your-bing-maps-API.aspx">Bing Maps</a>, etc.) as long as you conform to its terms of use. You can see the help page for the <code>addTiles</code> function in R, if needed, entering <code>?addTiles</code> in the R console.</p>

<p>We can display more than one map at a time with leaflet. For this example I am going to overlay another polygon feature that shows the <a href="http://landsat.usgs.gov/">Landsat</a> scenes that cover my study area based on the <a href="http://landsat.usgs.gov/tools_wrs-2_shapefile.php">WRS2 descending grid</a>. Let's read this second shapefile:</p>

<pre><code>wrs2 &lt;- shapefile("C:/my_dir/wrs2_desc.shp")
</code></pre>

<p><br>
As before, we create the Leaflet map widget, add the OSM tiles and add the polygons. For adding layers controls, we need to provide the name of the group the newly created layers should belong to. For example, I will define "Study area" as the group for the <code>llanos</code> layer, and the "Landsat scenes" group for the <code>wrs2</code> layer. For popups, the <code>popup</code> argument in the <code>addPolygons</code> function is used to display attribute data from the vector map. In this case, I am using a column called 'PATH_ROW' that indicates the path and row of the corresponding Landsat scene.</p>

<p>For the legend, we add pairs of values for the <code>colors</code> and <code>labels</code> arguments for the corresponding values of the two map layers. Finally, the <code>addLayersControl</code> function allows adding user interface controls to switch the layers on and off. We have to enter the name of the group each layer map belong to in the <code>overlayGroups</code> argument and then we define whether we want the layers control to be collapsed or not, using the <code>options</code> argument. The complete code snippet can be seen below:</p>

<pre><code>leaflet() %&gt;% addTiles() %&gt;%   
  addPolygons(data = llanos, fill = FALSE, stroke = TRUE, color = "#03F", group = "Study area") %&gt;% 
  addPolygons(data = wrs2, fill = TRUE, stroke = TRUE, color = "#f93", 
              popup = paste0("Scene: ", as.character(wrs2$PATH_ROW)), group = "Landsat scenes") %&gt;% 
  # add a legend
  addLegend("bottomright", colors = c("#03F", "#f93"), labels = c("Study area", "Landsat scenes (path - row)")) %&gt;%   
  # add layers control
  addLayersControl(
    overlayGroups = c("Study area", "Landsat scenes"),
    options = layersControlOptions(collapsed = FALSE)
  )
</code></pre>

<p><br>
Finally export the map as an html page. In the 'Viewer' tab in RStudio, click the 'Export' button and then click 'Save as Web page...'. Then you just need to upload your output html page to your website to make your map available online. You can see an example of a map created with leaflet in this <a href="http://amsantac.github.io/cuproject/www/landsat_scenes.html">link</a>.</p>

<p>Once uploaded, you can also embed your map in another web page inserting a code snippet like the one below wherever you want to display it:</p>

<div font style="BACKGROUND-COLOR:#f5f5f5;line-height:0.8">
<xmp font style="border:1px solid;border-color:#d1d1d1;black;border-radius:3px;padding: 0em 0 0.3em 0.3em">
<iframe id="map_id" width=700 height=500 src="http://mywebsite.com/my_map.html"></iframe>
</xmp>
</font></div>


<p>Now you have a fancy web map with legend, layers controls and popups:</p>

<iframe id="map_llanos_emb" width=785 height=500 src="http://amsantac.github.io/cuproject/www/landsat_scenes.html"></iframe>


<p><br>
That's it. Congratulations for finishing this first tutorial!</p>

<p><a id="comments"></a></p>

  <!-- </article> -->

  <br>
  <p><strong>Share this post: &nbsp;&nbsp;</strong></p>
  
  <!-- facebook button -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- g+ button -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  
  <!-- twitter button -->
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  
  
  <div class="social-share">
    <!--<g:plusone></g:plusone>--> 
    <div class="g-plusone" data-size="medium"></div><div class="fb-share-button" data-href="http://amsantac.co/blog/en/r/2015/08/11/leaflet-R.html" data-layout="button_count"></div> <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://amsantac.co/blog/en/r/2015/08/11/leaflet-R.html">Tweet</a>

    </div>
  <br>
  
  <br>
  
      <p class="rss-subscribe"><strong>Subscribe to my blog <a href="/feed.en.xml">via RSS</a></strong> &nbsp;<a href="/feed.en.xml"><img src="/images/rss.jpg" alt="" style="right;width:15px;height:15px;"/></a></p>
  
  <br>

<!--  <h2>Comments Section</h2> -->

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'r-spatialist';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script>
$( "pre" ).addClass( "prettyprint lang-r" );
</script>

<!-- <div> -->
<!-- </div> -->

<!-- permalink: /blog/:title -->
							  </article>
						</section>
					</div>

					<!-- <span class="byline">Subtitle</span> -->

				
					<div id="sidebar" class="4u">
					  <hr>
					  
					  
					  <a href="https://plus.google.com/u/0/117898713832632782598/"><img src="/images/g+32.png" title="Google+" style="height:32px"></a>  <a href="https://www.linkedin.com/in/amsantac"><img src="/images/linkedin.png" title="LinkedIn" style="height:32px"></a> <a href="http://www.researchgate.net/profile/Ali_Santacruz"><img src="/images/rg-icon-180x180.png" title="ResearchGate" style="height:32px"></a> <a href="https://www.facebook.com/amsantac"><img src="/images/F_icon.png" title="Facebook" style="height:32px"></a>  <a href="/feed.xml"><img src="/images/rss.jpg" title="RSS" style="height:32px"></a>


					  <hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Highlighted blog posts</h2>
							</header>
							<ul class="style">
							  

								
								<li>
									<a href="/blog/en/r/2015/09/05/stacking-R.html"><img src="/images/2015-09-05-stacking-R-icon.png" alt="" width=70 height=70/></a>
									<p class="text"><h4><a href="/blog/en/r/2015/09/05/stacking-R.html">Using R for file stacking in CLASlite</a></h4></p>
									<p class="posted">SEPTEMBER 5, 2015  |  <a href="/blog/en/r/2015/09/05/stacking-R.html#comments">COMMENTS</a></p>
								</li>
								
							</ul>
						</section>
						
						<hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Browse posts by tag</h2>
							</header>

									<p class="text">
									<h4>
									<a href="/tags/R"> R</a>
									&nbsp; | &nbsp; 
									<a href="/tags/GIS"> GIS</a>
									&nbsp; | &nbsp;
									<a href="/tags/RemoteSensing"> Remote Sensing</a>
									&nbsp; | &nbsp;
									<a href="/tags/landsat"> LANDSAT</a>
									&nbsp; | &nbsp; 
									<a href="/tags/CLASlite"> CLASlite </a>
									</h4>
									</p>
									
						</section>
						
					  <hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Recommended sites</h2>
							</header>
							<ul class="style">
								<li>
									<a href="https://plus.google.com/u/0/communities/108037738151282716907"><img src="/images/geomatica.jpg" width=70 height=70></a>
									<p class="text"><h4><a href="https://plus.google.com/u/0/communities/108037738151282716907">GEOMATICA</a></h4></p>
									<p class="posted">G+ COMMUNITY ABOUT GIS & RS</p>
								</li>

								<li>
									<a href="https://plus.google.com/u/0/collection/oefHm"><img src="/images/r-collection-icon.png" width=70 height=70/></a>
									<p class="text"><h4><a href="https://plus.google.com/u/0/collection/oefHm">The R Collection</a></h4></p>
									<p class="posted">SELECTED NEWS AND TIPS ABOUT R</a></p>
								</li>
								
								<li>
									<a href="http://www.r-bloggers.com"><img src="/images/rbloggers.png" width=70 height=70/></a>
									<p class="text"><h4><a href="http://www.r-bloggers.com/">R-BLOGGERS</a></h4></p>
									<p class="posted">R NEWS AND TUTORIALS</a></p>
								</li>

								<li>
									<a href="https://www.facebook.com/DronITech"><img src="/images/CaptureDronEs.png" width=70 height=70/></a>
									<p class="text"><h4><a href="https://www.facebook.com/DronITech">DronIT</a></h4></p>
									<p class="posted">NEWS ABOUT DRONES TECHNOLOGY</a></p>
								</li>

							</ul>
						</section>						
						
					</div>
					<!-- Sidebar -->




				</div>
			</div>
		</div>

    		<!-- Footer -->
		<div id="featured">
			<div class="container">
				<div class="row">
					<div class="4u">
						<h2>The geospt package</h2>
						<a href="/software.html" class="image full"><img src="/images/geospt-featured.png" alt="" /></a>
						<p>This R package provides a set of geostatistical techniques for variogram estimation and cross-validation as well as methods for the design of optimal spatial sampling networks.</p>
						<p><a href="/software.html" class="button">More Details</a></p>
					</div>
					<div class="4u">
						<h2>The diffeR package</h2>
						<a href="/software.html" class="image full"><img src="/images/differ-featured.png" alt="" /></a>
						<p>The diffeR package implements a set of metrics of difference for comparing pairs of maps representing real or categorical variables at original and multiple resolutions.</p>
						<p><a href="/software.html" class="button">More Details</a></p>
					</div>
					<div class="4u">
						<h2>The TOC package</h2>
						<a href="/software.html" class="image full"><img src="/images/toc-featured.png" alt="" /></a>
						<p>This R package allows the construction of the Receiver (aka Relative) Operating Characteristic (ROC) curve and the Total Operating Characteristic (TOC) curve for spatial and non-spatial data.</p>
						<p><a href="/software.html" class="button">More Details</a></p>
					</div>
				</div>
			</div>
		</div>


		<!-- Footer -->
		<div id="footer">
			<div class="container">
				<div class="row">
					<div class="4u">
						<section>
							<h2>Latest Posts</h2>
							<ul class="default">
								
								<li><a href="/blog/en/r/2015/09/05/stacking-R.html">Using R for file stacking in CLASlite</a></li>
								<li><a href="/blog/en/r/2015/08/11/leaflet-R.html">Web mapping with Leaflet and R</a></li>
								<li><a href="/blog/en/2015/08/09/first-post.html">Welcome to the R-Spatialist Blog!</a></li>
								<li><a href="#"></a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Latest publications</h2>
							<ul class="default">
								<li><a href="/publications.html">Quantity and allocation metrics for comparing maps</a></li>
								<li><a href="/publications.html">Evolutionary optimization of spatial sampling networks</a></li>
								<li><a href="/publications.html">Land use change and the landscape matrix  dynamics</a></li>
								<li><a href="/publications.html">Maximizing CDM forestry projects profitability</a></li>
								<li><a href="/publications.html">Classification of rice crops using Radarsat-2</a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Software packages</h2>
							<ul class="default">
								<li><a href="/software.html">The Llanos GEE web app</a></li>
								<li><a href="/software.html">TOC R Shiny web app</a></li>
								<li><a href="/software.html">The TOC R package</a></li>
								<li><a href="/software.html">The diffeR R package</a></li>
								<li><a href="/software.html">The geospt R package</a></li>
							</ul>
						</section>
					</div>
				</div>
			</div>
		</div>
		
	  <!-- Copyright -->
		<div id="copyright">
			<div class="container">
			  <!--
				Design: <a href="http://templated.co">TEMPLATED</a> Images: <a href="http://unsplash.com">Unsplash</a> (<a href="http://unsplash.com/cc0">CC0</a>)
				-->
				&copy; Ali Santacruz - <a href="/blog.html">Version en espanol</a>
			</div>
		</div>

    
  </body>

</html>

<!--
	Iridium by TEMPLATED
    templated.co @templatedco
    Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
					<!-- Content 
					<div id="content" class="8u skel-cell-important">
					  
					  </div>
					
					Sidebar 
					<div>
					
					</div> -->
		
