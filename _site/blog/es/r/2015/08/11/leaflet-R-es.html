<!DOCTYPE html>
<html>

  <head profile="http://www.w3.org/2005/10/profile">
  <meta charset="utf-8">
  <!--<meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="" />
  <meta name="keywords" content="" />

  <title>Mapeo web con Leaflet y R</title>
  <meta name="description" content="Leaflet es una librería de JavaScript my popular para la creación de mapas interactivos. Una forma de crear un mapa usando la librería JavaScript de Leaflet ...">
  
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"> -->
  
  <link href='http://fonts.googleapis.com/css?family=Arimo:400,700' rel='stylesheet' type='text/css'>
		<!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->

		<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=r"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="/js/skel.min.js"></script>
		<script src="/js/skel-panels.min.js"></script>
		<script src="/js/init.js"></script>
		<link rel="stylesheet" href="/css/prettify.css"/>

		<noscript>
			<link rel="stylesheet" href="http://amsantac.co/css/skel-noscript.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style.css"/>
			<link rel="stylesheet" href="http://amsantac.co/css/style-desktop.css"/>
			<!-- <link rel="stylesheet" href="http://amsantac.co/css/main.css"> -->
			<link rel="canonical" href="http://amsantac.co/blog/es/r/2015/08/11/leaflet-R-es.html">
			<link rel="alternate" type="application/rss+xml" title="R-Spatialist" href="/feed.xml" />
		</noscript>
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		
		<link href='http://amsantac.co/feed.es.xml' rel='alternate' type='application/atom+xml'>
		<link rel="canonical" href="http://amsantac.co/blog/es/r/2015/08/11/leaflet-R-es.html">
		
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66136840-1', 'auto');
  ga('send', 'pageview');

  </script>
 <link rel="shortcut icon" href="/favicon.ico">
</head>


  <body>

    		<!-- Header -->
		<div id="header">
			<div class="container"> 
				
				<!-- Logo -->
								<div id="logo">
					<h1><a href="/es/">amsantac.co</a></h1>
					<span>Soluciones eficientes para el procesamiento de datos geoespaciales</span>
				</div>

				
				<!-- Nav -->
				<nav id="nav">
					<ul>
						<li><a href="/es/">Inicio</a></li>
						<li><a href="/es/about.html">Acerca de mí</a></li>
						<li><a href="/es/software.html">Software</a></li>
						<li><a href="/es/publications.html">Publicaciones</a></li>
						<li><a href="/es/training.html">Capacitación</a></li>
						<li class="active"><a href="/es/blog.html">Blog</a></li>
						<li><a href="/es/contact.html">Contacto</a></li>
					</ul>
				</nav>
			</div>
		</div>

    
    		<!-- Main -->
		<div id="main">
			<div class="container">
				<div class="row"> 

													<div id="content" class="8u skel-cell-important">
						<section>
							<header>
								<h1>Mapeo web con Leaflet y R</h1>
								
							</header>
							  <article class="post-content">
							        <p><em>Aug 11, 2015</em></p>


  <!-- <article> -->
    <p><a href="http://leafletjs.com/">Leaflet</a> es una librería de JavaScript my popular para la creación de mapas interactivos. Una forma de crear un mapa usando la librería JavaScript de Leaflet es incluir los archivos de la librería Leaflet y los archivos de estilo (CSS) en la cabecera de la página y luego definir la configuración del mapa en el cuerpo de la página html.</p>

<p>Una forma alternativa es crear el mapa web usando un paquete desarrollado para el <a href="https://www.r-project.org/">lenguaje R</a> llamado <a href="http://leafletjs.com/">leaflet</a>, desarrollado por la gente de <a href="https://www.rstudio.com/">RStudio</a>, el cual permite controlar e integrar mapas de Leaflet en R. En esta entrada del blog explico cómo leer en R un mapa vectorial en formato <a href="https://doc.arcgis.com/en/arcgis-online/reference/shapefiles.htm">shapefile</a> y cómo crear un mapa web con leaflet personalizando la forma en que el mapa vectorial es presentado. También describo cómo adicionar una legenda, un control para las capas y popups para desplegar datos de la tabla de atributos. <!--more--> Para el propósito de este tutorial recomiendo utilizar el programa <a href="https://www.rstudio.com/">RStudio</a>.</p>

<p>Primero necesitamos instalar el paquete leaflet en R ingresando la siguiente línea de comando en la consola de R:</p>

<pre><code>install.packages("leaflet")
</code></pre>

<p><br>
El siguiente paso es importar en R los mapas que deseamos visualizar en nuestro mapa web. Existen varias funciones disponibles en diferentes paquetes de R (ver <a href="https://cran.r-project.org/package=rgdal">rgdal</a>, <a href="https://cran.r-project.org/package=maptools">maptools</a>, <a href="https://cran.r-project.org/package=shapefiles">shapefiles</a>, y <a href="http://gis.stackexchange.com/questions/118077/read-esri-shape-file-polygon-or-polyline-in-r-environment">otros</a>). Aquí voy a utilizar el paquete <a href="https://cran.r-project.org/package=raster">raster</a>, así que primero necesitamos instalarlo:</p>

<pre><code>install.packages("raster")
</code></pre>

<p><br>
Ahora carguemos los dos paquetes:</p>

<pre><code>library(raster)
 library(leaflet)
</code></pre>

<p><br>
Para este ejemplo voy a importar en R un shapefile de polígonos que abarca el área de estudio de uno de mis proyectos. La proyección de este mapa está definida en coordenadas geográficas (latitud/longitud). Usemos la función <code>shapefile</code> del paquete raster para leer el archivo:</p>

<pre><code>llanos &lt;- shapefile("C:/my_dir/llanos.shp")
</code></pre>

<p><br>
En este caso el archivo ha sido leído en R como un objeto de clase <a href="http://www.inside-r.org/packages/cran/sp/docs/as.data.frame.SpatialPolygonsDataFrame">SpatialPolygonsDataFrame</a> que he llamado <code>llanos</code>. Ahora vamos a crear un mapa leaflet usando este objeto para el argumento <code>data</code> en la función <code>leaflet</code>. Podemos hacer eso en una sola línea de código concatenando varios comandos con el operador <code>%&gt;%</code>. Primero creamos un <em>widget</em> para un mapa Leaflet (con el comando <code>leaflet</code>) y luego adicionamos la capa de referencia de fondo (con <code>addTiles</code>), el mapa vectorial como un polígono (<code>addPolygons</code>) y una leyenda (<code>addLegend</code>).</p>

<pre><code>leaflet(data = llanos) %&gt;% addTiles() %&gt;% addPolygons(fill = FALSE, stroke = TRUE, color = "#03F") %&gt;% 
  addLegend("bottomright", colors = "#03F", labels = "Llanos ecoregion")
</code></pre>

<p><br>
Los argumentos <code>fill</code>, <code>stroke</code> y <code>color</code> permiten personalizar si deseamos rellenar el polígono con color, si deseamos dibujar el borde del polígono, y definir el color del borde, respectivamente. Para el comando <code>addLegend</code>, definimos la posición, los colores y las etiquetas de la leyenda. Si estás trabajando en RStudio, deberías ver tu mapa desplegado en la pestaña 'Viewer' una vez presiones la tecla Enter:</p>

<p><img src="/images/2015-08-11-leaflet-R-fig-1.png" alt="Web map with leaflet" style="width:785px"></p>

<p>Leaflet despliega una capa de <a href="http://www.openstreetmap.org/">OpenStreetMap (OSM)</a> por defecto pero puedes usar cualquier servicio proveedor de mapas (e.g., <a href="http://www.mapquest.com/">MapQuest Open</a>, <a href="https://www.mapbox.com/">MapBox</a>, <a href="http://www.microsoft.com/maps/choose-your-bing-maps-API.aspx">Bing Maps</a>, etc.) en tanto que aceptes los términos de uso correspondientes. Si lo necesitas puedes revisar la página de ayuda de la función <code>addTiles</code> ingresando <code>?addTiles</code> en la consola de R.</p>

<p>Es posible visualizar más de un mapa a la vez con leaflet. Para este ejemplo voy a superponer otro mapa de polígonos que muestra las escenas de <a href="http://landsat.usgs.gov/">Landsat</a> que cubren mi área de estudio con base en la <a href="http://landsat.usgs.gov/tools_wrs-2_shapefile.php">grilla de referencia WRS2</a>. Importemos este segundo shapefile:</p>

<pre><code>wrs2 &lt;- shapefile("C:/my_dir/wrs2_desc.shp")
</code></pre>

<p><br>
Como lo hicimos anteriormente, creamos el widget del mapa Leaflet, adicionamos la capa OSM y añadimos los polígonos. Para incluir los controles de las capas, necesitamos indicar el nombre del grupo a los cuales pertenecen las nuevas capas. Por ejemplo, voy a crear el grupo "Study area" para la capa <code>llanos</code>, y el grupo "Landsat scenes" para la capa <code>wrs2</code>. En cuanto a los popups, el argumento <code>popup</code> en la función <code>addPolygons</code> es utilizado para desplegar datos de la tabla de atributos del mapa vectorial. En este caso, estoy usando una columna llamada 'PATH_ROW' que indica las propiedades 'path' y 'row' de la correspondiente escena de Landsat.</p>

<p>Con respecto a la leyenda, debemos adicionar parejas de valores para los argumentos <code>colors</code> y <code>labels</code> para los valores correspondientes de las dos capas de mapas. Finalmente, la función <code>addLayersControl</code> realiza la adición de controles para la interfaz de usuario para permitir prender y apagar las capas. Debemos ingresar el nombre del grupo al cual pertenece cada capa en el argumento <code>overlayGroups</code> y luego debemos definir si deseamos que el control de las capas esté colapsado o no, usando el argumento <code>options</code>. El fragmento completo del código lo puedes ver a continuación:</p>

<pre><code>leaflet() %&gt;% addTiles() %&gt;%   
  addPolygons(data = llanos, fill = FALSE, stroke = TRUE, color = "#03F", group = "Study area") %&gt;% 
  addPolygons(data = wrs2, fill = TRUE, stroke = TRUE, color = "#f93", 
              popup = paste0("Scene: ", as.character(wrs2$PATH_ROW)), group = "Landsat scenes") %&gt;% 
  # add a legend
  addLegend("bottomright", colors = c("#03F", "#f93"), labels = c("Study area", "Landsat scenes (path - row)")) %&gt;%   
  # add layers control
  addLayersControl(
    overlayGroups = c("Study area", "Landsat scenes"),
    options = layersControlOptions(collapsed = FALSE)
  )
</code></pre>

<p><br>
Finalmente podemos exportar el mapa como una página html. En la pestaña 'Viewer' de RStudio, haz click en el botón 'Export' y luego en 'Save as Web page...'. Posteriormente ya solo necesitas subir la página html que guardaste a tu sitio web para hacer que tu mapa esté disponible en internet. Puedes ver un ejemplo de un mapa creado con leaflet en este <a href="http://amsantac.github.io/cuproject/www/landsat_scenes.html">link</a>.</p>

<p>Una vez subido a la web, puedes incrustar tu mapa en otras páginas web insertando un fragmento de código como el que presento a continuación donde sea que desees mostrar tu mapa:</p>

<div font style="BACKGROUND-COLOR:#f5f5f5;line-height:0.8">
<xmp font style="border:1px solid;border-color:#d1d1d1;black;border-radius:3px;padding: 0em 0 0.3em 0.3em">
<iframe id="map_id" width=700 height=500 src="http://mywebsite.com/my_map.html"></iframe>
</xmp>
</font></div>


<p>Si has seguido estos pasos, ahora debes tener un muy elegante mapa web con leyenda, controles de capas y popups:</p>

<iframe id="map_llanos_emb" width=785 height=500 src="http://amsantac.github.io/cuproject/www/landsat_scenes.html"></iframe>


<p><br>
Eso es todo. Felicitaciones por completar este primer tutorial!</p>

<p><a id="comments"></a></p>

  <!-- </article> -->

  <br>
  <p><strong>Comparte este post: &nbsp;&nbsp;</strong></p>
  
  <!-- facebook button -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v2.4";
  fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

  <!-- g+ button -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  
  <!-- twitter button -->
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  
  
  <div class="social-share">
    <!--<g:plusone></g:plusone>--> 
    
<div class="g-plusone" data-size="medium"></div> <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://amsantac.co/blog/es/r/2015/08/11/leaflet-R-es.html">Tweet</a>
<div class="fb-share-button" data-href="http://amsantac.co/blog/es/r/2015/08/11/leaflet-R-es.html" data-layout="button_count" style="vertical-align: top !important;"></div>

    </div>
  <br>
  
  <br>
  
      <p class="rss-subscribe"><strong>Subscríbete a mi blog <a href="/feed.es.xml">via RSS</a></strong> &nbsp;<a href="/feed.es.xml"><img src="/images/rss.jpg" alt="" style="right;width:15px;height:15px;"/></a></p>
  
  <br>

<!--  <h2>Comments Section</h2> -->

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'r-spatialist';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<script>
$( "pre" ).addClass( "prettyprint lang-r" );
</script>

<!-- <div> -->
<!-- </div> -->

<!-- permalink: /blog/:title -->
							  </article>
						</section>
					</div>

					<!-- <span class="byline">Subtitle</span> -->

				
					<div id="sidebar" class="4u">
					  <hr>
					  
					  
					  <a href="https://plus.google.com/u/0/117898713832632782598/"><img src="/images/g+32.png" title="Google+" style="height:32px"></a>  <a href="https://www.linkedin.com/in/amsantac"><img src="/images/linkedin.png" title="LinkedIn" style="height:32px"></a> <a href="http://www.researchgate.net/profile/Ali_Santacruz"><img src="/images/rg-icon-180x180.png" title="ResearchGate" style="height:32px"></a> <a href="https://www.facebook.com/amsantac"><img src="/images/F_icon.png" title="Facebook" style="height:32px"></a>  <a href="/feed.es.xml"><img src="/images/rss.jpg" title="RSS" style="height:32px"></a>


					  <hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Posts recomendados</h2>
							</header>
							<ul class="style">
							  

								
								<li>
									<a href="/blog/es/r/2015/09/05/stacking-R.html"><img src="/images/2015-09-05-stacking-R-icon.png" alt="" width=70 height=70/></a>
									<p class="text"><h4><a href="/blog/es/r/2015/09/05/stacking-R.html">Usando R para el apilamiento de imágenes en CLASlite</a></h4></p>
									<p class="posted">SEPTIEMBRE 5, 2015  |  <a href="/blog/es/r/2015/09/05/stacking-R.html#comments">COMENTARIOS</a></p>
								</li>
								
							</ul>
						</section>
						
						<hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Navega en el blog por etiquetas</h2>
							</header>

									<p class="text">
									<h4>
									<a href="/tags-es/R"> R</a>
									&nbsp; | &nbsp; 
									<a href="/tags-es/SIG"> SIG</a>
									&nbsp; | &nbsp;
									<a href="/tags-es/PercepcionRemota"> Percepción Remota</a>
									&nbsp; | &nbsp;
									<a href="/tags-es/landsat"> LANDSAT</a>
									&nbsp; | &nbsp; 
									<a href="/tags-es/CLASlite"> CLASlite </a>
									</h4>
									</p>
									
						</section>
						
					  <hr>

					  <br>
					  <br>
					  
						<section>
							<header>
								<h2>Sitios web recomendados</h2>
							</header>
							<ul class="style">
								<li>
									<a href="https://plus.google.com/u/0/communities/108037738151282716907"><img src="/images/geomatica.jpg" width=70 height=70></a>
									<p class="text"><h4><a href="https://plus.google.com/u/0/communities/108037738151282716907">GEOMATICA</a></h4></p>
									<p class="posted">COMUNIDAD EN G+ SOBRE SIG Y PR</p>
								</li>

								<li>
									<a href="https://plus.google.com/u/0/collection/oefHm"><img src="/images/r-collection-icon.png" width=70 height=70/></a>
									<p class="text"><h4><a href="https://plus.google.com/u/0/collection/oefHm">The R Collection</a></h4></p>
									<p class="posted">NOTICIAS Y TIPS ACERCA DE R</a></p>
								</li>
								
								<li>
									<a href="http://www.r-bloggers.com"><img src="/images/rbloggers.png" width=70 height=70/></a>
									<p class="text"><h4><a href="http://www.r-bloggers.com/">R-BLOGGERS</a></h4></p>
									<p class="posted">TUTORIALES Y NOTICIAS SOBRE R</a></p>
								</li>

								<li>
									<a href="https://www.facebook.com/DronITech"><img src="/images/CaptureDronEs.png" width=70 height=70/></a>
									<p class="text"><h4><a href="https://www.facebook.com/DronITech">DronIT</a></h4></p>
									<p class="posted">NOTICIAS SOBRE DRONES Y TECNOLOGIA</a></p>
								</li>

							</ul>
						</section>						
						
					</div>
					<!-- Sidebar -->




				</div>
			</div>
		</div>

    		<!-- Footer -->
		<div id="featured">
			<div class="container">
				<div class="row">
					<div class="4u">
						<h2>El paquete geospt</h2>
						<a href="/es/software.html" class="image full"><img src="/images/geospt-featured.png" alt="" /></a>
						<p>
						Este paquete de R contiene un conjunto de técnicas geoestadísticas para la estimación del variograma y la validación cruzada, así como métodos para el diseño de redes óptimas de muestreo. 
						</p>
						<p><a href="/es/software.html" class="button">Más Detalles</a></p>
					</div>
					
					<div class="4u">
						<h2>El paquete diffeR</h2>
						<a href="/software.html" class="image full"><img src="/images/differ-featured.png" alt="" /></a>
						<p>
						El paquete diffeR implementa un conjunto de métricas de diferencia para comparar pares de mapas que representen variables categóricas o reales, a la resolución original o a múltiples resoluciones.</p>
						<p><a href="/es/software.html" class="button">Más Detalles</a></p>
					</div>
					
					<div class="4u">
						<h2>El paquete TOC</h2>
						<a href="/es/software.html" class="image full"><img src="/images/toc-featured.png" alt="" /></a>
						<p>
						Este paquete de R permite la construcción de la curva ROC (i.e., Receiver (aka Relative) Operating Characteristic) y la curva TOC (i.e., Total Operating Characteristic) para datos espaciales y no espaciales.
						</p>
						<p><a href="/es/software.html" class="button">Más Detalles</a></p>
					</div>
				</div>
			</div>
		</div>


		<!-- Footer -->
		<div id="footer">
			<div class="container">
				<div class="row">
					<div class="4u">
						<section>
							<h2>Posts más recientes</h2>
							<ul class="default">
								
								<li><a href="/blog/es/r/2015/09/05/stacking-R.html">Usando R para el apilamiento de imágenes en CLASlite</a></li>
								<li><a href="/blog/es/r/2015/08/11/leaflet-R.html">Mapeo web con Leaflet y R</a></li>
								<li><a href="/blog/es/2015/08/09/first-post.html">Bienvenido a mi Blog: The R-Spatialist</a></li>
								<li><a href="#"></a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Publicaciones más recientes</h2>
							<ul class="default">
								<li><a href="/es/publications.html">Métricas de cantidad y alocación para comparar mapas</a></li>
								<li><a href="/es/publications.html">Optimización de redes espaciales de muestreo</a></li>
								<li><a href="/es/publications.html">Dinámica de la matriz del paisaje</a></li>
								<li><a href="/es/publications.html">Maximizando la rentabilidad de proyectos forestales</a></li>
								<li><a href="/es/publications.html">Clasificación de cultivos de arroz usando Radarsat-2</a></li>
							</ul>
						</section>
					</div>
					<div class="4u">
						<section>
							<h2>Paquetes de software y apps</h2>
							<ul class="default">
								<li><a href="/es/software.html">App web Los Llanos basada en Google Earth Engine</a></li>
								<li><a href="/es/software.html">App web TOC implementada con R y Shiny</a></li>
								<li><a href="/es/software.html">El paquete TOC para R</a></li>
								<li><a href="/es/software.html">El paquete diffeR para R</a></li>
								<li><a href="/es/software.html">El paquete geospt para R</a></li>
							</ul>
						</section>
					</div>
				</div>
			</div>
		</div>
		
	  <!-- Copyright -->
		<div id="copyright">
			<div class="container">
			  <!--
				Design: <a href="http://templated.co">TEMPLATED</a> Images: <a href="http://unsplash.com">Unsplash</a> (<a href="http://unsplash.com/cc0">CC0</a>)
				-->
				&copy; Alí Santacruz - <a href="/">English version</a>
			</div>
		</div>

    
  </body>

</html>

<!--
	Iridium by TEMPLATED
    templated.co @templatedco
    Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
					<!-- Content 
					<div id="content" class="8u skel-cell-important">
					  
					  </div>
					
					Sidebar 
					<div>
					
					</div> -->
		
