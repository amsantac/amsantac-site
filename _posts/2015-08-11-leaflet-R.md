---
layout: post
title:  "Web mapping with Leaflet and R"
date:   2015-08-11 11:02:52
categories: blog leaflet R webmapping
---

[Leaflet] is a JavaScript library that has become quite popular for creating interactive maps. In this post I explain how to create a Leaflet map that shows (e.g., a shapefile) .  Quisque erat. Vestibulum pellentesque,

using an R package called [leaflet] developed by the guys from [RStudio]. The leaflet R package allows controlling and integrating Leaflet maps in the R environment. I recommend to use the [RStudio IDE] for the purpose of this tutorial.

First we need to install the leaflet package in R entering the following command line in the R console:

```
install.packages("leaflet")
```
<br>
fefafa

```
install.packages("leaflet")

```
<br>
Now we load the two packages:

```
library(raster)
library(leaflet)
```
<br>
The next step is to read in R the maps we want to display in our web map. For this example I am going to use a polygon shapefile enclosing the study area of one of my projects. The projection of this map is defined in geographic coordinates (latitude/longitude). Let's use the `shapefile` function from the raster package:

```
llanos <- shapefile("C:/my_dir/llanos.shp")
```
<br>
map_llanos.html

```
leaflet(data = llanos) %>% addTiles() %>%   addPolygons(fill = FALSE, stroke = TRUE, color = "#03F") %>% 
  addLegend("bottomright", colors = "#03F", labels = "Llanos ecoregion")
```
<br>
If you are working in RStudio, you should see your map displayed in the 'Viewer' tab:

<img src="/images/2015-08-11-leaflet-R-fig-1.png" alt="Web map with leaflet" style="width:785px">

Leaflet display [OpenStreetMap] tiles by default but you can use any map provider (e.g., [MapQuest Open], [MapBox], [Bing Maps], etc.) as long as you conform to its terms of use

```
llanos_wrs2 <- shapefile("C:/amsantac/PhD/Research/dissertation/data/landsat/wrs grids/llanos_wrs2_desc.shp")
```
<br>
add legend and layers control

```
leaflet() %>% addTiles() %>%   
  addPolygons(data = llanos, fill = FALSE, stroke = TRUE, color = "#03F", group = "Study area") %>% 
  addPolygons(data = llanos_wrs2, fill = TRUE, stroke = TRUE, color = "#f93", 
              popup = paste0("Scene: ", as.character(llanos_wrs2$PATH_ROW)), group = "Landsat scenes") %>% 
  # add a legend
  addLegend("bottomright", colors = c("#03F", "#f93"), labels = c("Study area", "Landsat scenes (path - row)")) %>%   
  # add layers controls
  addLayersControl(
    overlayGroups = c("Study area", "Landsat scenes"),
    options = layersControlOptions(collapsed = FALSE)
  )
```
<br>
Finally export the map as an html page. In the 'Viewer' tab in RStudio, click the 'Export' button and then click 'Save as Web page...'. Then you just need to upload your output html page to your website to make your map available online. You can see an example of a map created with leaflet in this [link][web map]. 

Once uploaded, you can also embed your map in another web page inserting a code snippet like the one below wherever you want to display it: 

<div font style="BACKGROUND-COLOR:#f5f5f5;line-height:0.8">
<xmp font style="border:1px solid;border-color:#d1d1d1;black;border-radius:3px;padding: 0em 0 0.3em 0.3em">
<iframe id="map_id" width=700 height=500 src="http://mywebsite.com/my_map.html"></iframe>
</xmp>
</font></div>

Now you have a fancy web map with a legend, controls and pop-ups:

<iframe id="map_llanos_emb" width=785 height=500 src="http://amsantac.github.io/cuproject/www/landsat_scenes.html"></iframe>

<br>
That's it. Congratulations! 

[Leaflet]:         http://leafletjs.com/
[RStudio]:         https://www.rstudio.com/
[RStudio IDE]:     https://www.rstudio.com/products/rstudio/ 
[leaflet]:         https://rstudio.github.io/leaflet/
[R language]:      http://r-project.org
[rstudio_ss]:      /images/2015-08-11-leaflet-R-fig-1.png "Web map with leaflet"
[web map]:         http://amsantac.github.io/cuproject/www/map_llanos.html
[Open Street Map]: http://www.openstreetmap.org/
[MapQuest Open]:   http://www.mapquest.com/
[MapBox]:          https://www.mapbox.com/
[Bing Maps]:       http://www.microsoft.com/maps/choose-your-bing-maps-API.aspx

